<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emma Agent</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #did-agent {
            width: 100% !important;
            height: 100% !important;
            border: none;
        }
    </style>
</head>
<body>
    <div id="did-agent"></div>

    <script type="module"
            src="https://agent.d-id.com/v2/index.js"
            data-client-key="Z29vZ2xlLW9hdXRoMnwxMDExMDI5MTI1NDM4MzA1NjMwOTM6bFdfNGJaSHcxVkhDaE1RWTdOZjlf"
            data-agent-id="v2_agt_nTeMhzHR"
            data-name="did-agent">
    </script>

    <script>
        function sendToRN(type, data) {
            try {
                if (window.ReactNativeWebView) {
                    window.ReactNativeWebView.postMessage(JSON.stringify({ type, data }));
                }
            } catch (error) {
                console.log('RN ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:', error);
            }
        }

        // ê°€ì¥ ê°„ë‹¨í•œ í´ë¦­ í•¨ìˆ˜
        function clickAgent() {
            console.log('ğŸ¯ Agent í´ë¦­ ì‹œë„');
            
            // 1. Agent ì»¨í…Œì´ë„ˆ ì§ì ‘ í´ë¦­
            const agent = document.getElementById('did-agent');
            if (agent) {
                agent.click();
                console.log('Agent ì»¨í…Œì´ë„ˆ í´ë¦­');
            }
            
            // 2. í™”ë©´ ì „ì²´ì—ì„œ í´ë¦­ ê°€ëŠ¥í•œ ëª¨ë“  ìš”ì†Œ í´ë¦­
            const allElements = document.querySelectorAll('*');
            allElements.forEach((element, index) => {
                if (index < 50) { // ì²˜ìŒ 50ê°œë§Œ ì‹œë„
                    try {
                        element.click();
                    } catch (e) {}
                }
            });
            
            // 3. ì¢Œí‘œ ê¸°ë°˜ í´ë¦­ (ìš°í•˜ë‹¨)
            const clickEvent = new MouseEvent('click', {
                view: window,
                bubbles: true,
                cancelable: true,
                clientX: window.innerWidth - 200,
                clientY: window.innerHeight - 200
            });
            document.dispatchEvent(clickEvent);
            
            console.log('âœ… í´ë¦­ ì‹œë„ ì™„ë£Œ');
        }

        // Agent ë¡œë“œ ê°ì§€ ë° ìë™ í´ë¦­
        let attempts = 0;
        const checkAndClick = setInterval(() => {
            attempts++;
            console.log(`ì²´í¬ ì‹œë„ ${attempts}`);
            
            const agent = document.getElementById('did-agent');
            if (agent && agent.children.length > 0) {
                console.log('âœ… Agent ë°œê²¬! í´ë¦­ ì‹œì‘');
                
                // ì¦‰ì‹œ í´ë¦­
                clickAgent();
                
                // 1ì´ˆ í›„ ë‹¤ì‹œ í´ë¦­
                setTimeout(clickAgent, 1000);
                
                // 3ì´ˆ í›„ ë‹¤ì‹œ í´ë¦­
                setTimeout(clickAgent, 3000);
                
                // 5ì´ˆ í›„ ë‹¤ì‹œ í´ë¦­
                setTimeout(clickAgent, 5000);
                
                clearInterval(checkAndClick);
                
                sendToRN('agentReady', { agent: { name: 'Emma' } });
                sendToRN('connectionStateChange', { state: 'connected' });
                
            } else if (attempts > 30) {
                console.log('âŒ Agent ë¡œë“œ ì‹¤íŒ¨');
                clearInterval(checkAndClick);
                sendToRN('agentError', { error: 'Agent load timeout' });
            }
        }, 1000);

        // í˜ì´ì§€ ë¡œë“œ í›„ì—ë„ ì£¼ê¸°ì ìœ¼ë¡œ í´ë¦­
        setTimeout(() => {
            setInterval(clickAgent, 10000); // 10ì´ˆë§ˆë‹¤ í´ë¦­
        }, 10000);

        console.log('Emma Agent ì´ˆê¸°í™” ì‹œì‘');
    </script>
</body>
</html>